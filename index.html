<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Trends</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Job Trends</h1>
    <form id="trends-form">
        <label for="professions">Select professions:</label>
        <select id="professions" name="professions" multiple>
            <!-- Add options here -->
        </select>
        <br>
        <label for="locations">Select locations:</label>
        <select id="locations" name="locations" multiple>
            <!-- Add options here -->
        </select>
        <br>
        <button type="button" id="get-trends-btn">Get Trends</button>
    </form>
    <canvas id="trendChart" width="400" height="200"></canvas>
    <script>
        document.getElementById('get-trends-btn').addEventListener('click', async () => {
            const professions = Array.from(document.getElementById('professions').selectedOptions).map(opt => opt.value);
            const locations = Array.from(document.getElementById('locations').selectedOptions).map(opt => opt.value);
            
            const promises = [];
            for (const profession of professions) {
                for (const location of locations) {
                    const url = `https://trends-service-bz32sn4tyq-uc.a.run.app/trends?profession=${profession}&location=${location}`;
                    promises.push(fetch(url).then(response => response.json()));
                }
            }
            
            const results = await Promise.all(promises);
            const mergedData = results.flat();
            
            const ctx = document.getElementById('trendChart').getContext('2d');
            if (window.trendChart) {
                window.trendChart.destroy();
            }
            window.trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: professions.map((profession, index) => ({
                        label: `${profession} in ${locations[index]}`,
                        data: mergedData.filter(d => d.profession === profession && d.location === locations[index]),
                        borderColor: getRandomColor(),
                        fill: false
                    }))
                },
                options: {
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'week'
                            },
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Trend Value'
                            }
                        }
                    }
                }
            });
        });

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }
    </script>
</body>
</html>
